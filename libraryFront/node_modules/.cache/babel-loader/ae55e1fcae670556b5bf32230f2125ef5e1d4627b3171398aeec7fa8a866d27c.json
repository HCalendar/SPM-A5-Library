{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, computed } from 'vue';\nfunction useAllowCreate(props, states) {\n  const createOptionCount = ref(0);\n  const cachedSelectedOption = ref(null);\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable;\n  });\n  function hasExistingOption(query) {\n    const hasValue = option => option.value === query;\n    return props.options && props.options.some(hasValue) || states.createdOptions.some(hasValue);\n  }\n  function selectNewOption(option) {\n    if (!enableAllowCreateMode.value) {\n      return;\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++;\n    } else {\n      cachedSelectedOption.value = option;\n    }\n  }\n  function createNewOption(query) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0 && !hasExistingOption(query)) {\n        const newOption = {\n          value: query,\n          label: query,\n          created: true,\n          disabled: false\n        };\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption;\n        } else {\n          states.createdOptions.push(newOption);\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value;\n        } else {\n          const selectedOption = cachedSelectedOption.value;\n          states.createdOptions.length = 0;\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption);\n          }\n        }\n      }\n    }\n  }\n  function removeNewOption(option) {\n    if (!enableAllowCreateMode.value || !option || !option.created) {\n      return;\n    }\n    const idx = states.createdOptions.findIndex(it => it.value === option.value);\n    if (~idx) {\n      states.createdOptions.splice(idx, 1);\n      createOptionCount.value--;\n    }\n  }\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0;\n      createOptionCount.value = 0;\n    }\n  }\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption\n  };\n}\nexport { useAllowCreate };","map":{"version":3,"names":["props","states","createOptionCount","ref","cachedSelectedOption","enableAllowCreateMode","computed","allowCreate","filterable","hasExistingOption","query","hasValue","option","value","options","some","createdOptions","selectNewOption","multiple","created","createNewOption","length","newOption","label","disabled","push","selectedOption","removeNewOption","idx","findIndex","it","splice","clearAllNewOption"],"sources":["../../../../../../packages/components/select-v2/src/useAllowCreate.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport type { ISelectProps } from './token'\nimport type { Option } from './select.types'\n\nexport function useAllowCreate(props: ISelectProps, states) {\n  const createOptionCount = ref(0)\n  const cachedSelectedOption = ref<Option>(null)\n\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable\n  })\n\n  function hasExistingOption(query: string) {\n    const hasValue = (option) => option.value === query\n    return (\n      (props.options && props.options.some(hasValue)) ||\n      states.createdOptions.some(hasValue)\n    )\n  }\n\n  function selectNewOption(option: Option) {\n    if (!enableAllowCreateMode.value) {\n      return\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++\n    } else {\n      cachedSelectedOption.value = option\n    }\n  }\n\n  function createNewOption(query: string) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0 && !hasExistingOption(query)) {\n        const newOption = {\n          value: query,\n          label: query,\n          created: true,\n          disabled: false,\n        }\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption\n        } else {\n          states.createdOptions.push(newOption)\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value\n        } else {\n          const selectedOption = cachedSelectedOption.value\n          states.createdOptions.length = 0\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption)\n          }\n        }\n      }\n    }\n  }\n\n  function removeNewOption(option: Option) {\n    if (!enableAllowCreateMode.value || !option || !option.created) {\n      return\n    }\n    const idx = states.createdOptions.findIndex(\n      (it) => it.value === option.value\n    )\n    if (~idx) {\n      states.createdOptions.splice(idx, 1)\n      createOptionCount.value--\n    }\n  }\n\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0\n      createOptionCount.value = 0\n    }\n  }\n\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption,\n  }\n}\n"],"mappings":";;wBAI+BA,KAAA,EAAqBC,MAAA,EAAQ;EAC1D,MAAMC,iBAAA,GAAoBC,GAAA,CAAI;EAC9B,MAAMC,oBAAA,GAAuBD,GAAA,CAAY;EAEzC,MAAME,qBAAA,GAAwBC,QAAA,CAAS,MAAM;IAC3C,OAAON,KAAA,CAAMO,WAAA,IAAeP,KAAA,CAAMQ,UAAA;EAAA;EAGpC,SAAAC,kBAA2BC,KAAA,EAAe;IACxC,MAAMC,QAAA,GAAYC,MAAA,IAAWA,MAAA,CAAOC,KAAA,KAAUH,KAAA;IAC9C,OACGV,KAAA,CAAMc,OAAA,IAAWd,KAAA,CAAMc,OAAA,CAAQC,IAAA,CAAKJ,QAAA,KACrCV,MAAA,CAAOe,cAAA,CAAeD,IAAA,CAAKJ,QAAA;EAAA;EAI/B,SAAAM,gBAAyBL,MAAA,EAAgB;IACvC,IAAI,CAACP,qBAAA,CAAsBQ,KAAA,EAAO;MAChC;IAAA;IAEF,IAAIb,KAAA,CAAMkB,QAAA,IAAYN,MAAA,CAAOO,OAAA,EAAS;MACpCjB,iBAAA,CAAkBW,KAAA;IAAA,OACb;MACLT,oBAAA,CAAqBS,KAAA,GAAQD,MAAA;IAAA;EAAA;EAIjC,SAAAQ,gBAAyBV,KAAA,EAAe;IACtC,IAAIL,qBAAA,CAAsBQ,KAAA,EAAO;MAC/B,IAAIH,KAAA,IAASA,KAAA,CAAMW,MAAA,GAAS,KAAK,CAACZ,iBAAA,CAAkBC,KAAA,GAAQ;QAC1D,MAAMY,SAAA,GAAY;UAChBT,KAAA,EAAOH,KAAA;UACPa,KAAA,EAAOb,KAAA;UACPS,OAAA,EAAS;UACTK,QAAA,EAAU;QAAA;QAEZ,IAAIvB,MAAA,CAAOe,cAAA,CAAeK,MAAA,IAAUnB,iBAAA,CAAkBW,KAAA,EAAO;UAC3DZ,MAAA,CAAOe,cAAA,CAAed,iBAAA,CAAkBW,KAAA,IAASS,SAAA;QAAA,OAC5C;UACLrB,MAAA,CAAOe,cAAA,CAAeS,IAAA,CAAKH,SAAA;QAAA;MAAA,OAExB;QACL,IAAItB,KAAA,CAAMkB,QAAA,EAAU;UAClBjB,MAAA,CAAOe,cAAA,CAAeK,MAAA,GAASnB,iBAAA,CAAkBW,KAAA;QAAA,OAC5C;UACL,MAAMa,cAAA,GAAiBtB,oBAAA,CAAqBS,KAAA;UAC5CZ,MAAA,CAAOe,cAAA,CAAeK,MAAA,GAAS;UAC/B,IAAIK,cAAA,IAAkBA,cAAA,CAAeP,OAAA,EAAS;YAC5ClB,MAAA,CAAOe,cAAA,CAAeS,IAAA,CAAKC,cAAA;UAAA;QAAA;MAAA;IAAA;EAAA;EAOrC,SAAAC,gBAAyBf,MAAA,EAAgB;IACvC,IAAI,CAACP,qBAAA,CAAsBQ,KAAA,IAAS,CAACD,MAAA,IAAU,CAACA,MAAA,CAAOO,OAAA,EAAS;MAC9D;IAAA;IAEF,MAAMS,GAAA,GAAM3B,MAAA,CAAOe,cAAA,CAAea,SAAA,CAC/BC,EAAA,IAAOA,EAAA,CAAGjB,KAAA,KAAUD,MAAA,CAAOC,KAAA;IAE9B,IAAI,CAACe,GAAA,EAAK;MACR3B,MAAA,CAAOe,cAAA,CAAee,MAAA,CAAOH,GAAA,EAAK;MAClC1B,iBAAA,CAAkBW,KAAA;IAAA;EAAA;EAItB,SAAAmB,kBAAA,EAA6B;IAC3B,IAAI3B,qBAAA,CAAsBQ,KAAA,EAAO;MAC/BZ,MAAA,CAAOe,cAAA,CAAeK,MAAA,GAAS;MAC/BnB,iBAAA,CAAkBW,KAAA,GAAQ;IAAA;EAAA;EAI9B,OAAO;IACLO,eAAA;IACAO,eAAA;IACAV,eAAA;IACAe;EAAA;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}