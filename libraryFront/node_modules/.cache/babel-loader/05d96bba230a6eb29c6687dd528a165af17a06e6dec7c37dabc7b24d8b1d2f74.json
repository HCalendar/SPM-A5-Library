{"ast":null,"code":"import { defineComponent, inject, ref, computed, h, withCtx, renderSlot, withKeys, withModifiers } from 'vue';\nimport { isUndefined, getValueByPath } from '../../../utils/util.mjs';\nimport '../../virtual-list/index.mjs';\nimport './group-item.mjs';\nimport './option-item.mjs';\nimport { selectV2InjectionKey } from './token.mjs';\nimport { isObject } from '@vue/shared';\nimport FixedSizeList from '../../virtual-list/src/components/fixed-size-list.mjs';\nimport DynamicSizeList from '../../virtual-list/src/components/dynamic-size-list.mjs';\nimport script$1 from './group-item.vue_vue_type_script_lang.mjs';\nimport script$2 from './option-item.vue_vue_type_script_lang.mjs';\nvar script = defineComponent({\n  name: \"ElSelectDropdown\",\n  props: {\n    data: Array,\n    hoveringIndex: Number,\n    width: Number\n  },\n  setup(props) {\n    const select = inject(selectV2InjectionKey);\n    const cachedHeights = ref([]);\n    const listRef = ref(null);\n    const isSized = computed(() => isUndefined(select.props.estimatedOptionHeight));\n    const listProps = computed(() => {\n      if (isSized.value) {\n        return {\n          itemSize: select.props.itemHeight\n        };\n      }\n      return {\n        estimatedSize: select.props.estimatedOptionHeight,\n        itemSize: idx => cachedHeights.value[idx]\n      };\n    });\n    const contains = (arr = [], target) => {\n      const {\n        props: {\n          valueKey\n        }\n      } = select;\n      if (!isObject(target)) {\n        return arr.includes(target);\n      }\n      return arr && arr.some(item => {\n        return getValueByPath(item, valueKey) === getValueByPath(target, valueKey);\n      });\n    };\n    const isEqual = (selected, target) => {\n      if (!isObject(target)) {\n        return selected === target;\n      } else {\n        const {\n          valueKey\n        } = select.props;\n        return getValueByPath(selected, valueKey) === getValueByPath(target, valueKey);\n      }\n    };\n    const isItemSelected = (modelValue, target) => {\n      if (select.props.multiple) {\n        return contains(modelValue, target.value);\n      }\n      return isEqual(modelValue, target.value);\n    };\n    const isItemDisabled = (modelValue, selected) => {\n      const {\n        disabled,\n        multiple,\n        multipleLimit\n      } = select.props;\n      return disabled || !selected && (multiple ? multipleLimit > 0 && modelValue.length >= multipleLimit : false);\n    };\n    const isItemHovering = target => props.hoveringIndex === target;\n    const scrollToItem = index => {\n      const list = listRef.value;\n      if (list) {\n        list.scrollToItem(index);\n      }\n    };\n    const resetScrollTop = () => {\n      const list = listRef.value;\n      if (list) {\n        list.resetScrollTop();\n      }\n    };\n    return {\n      select,\n      listProps,\n      listRef,\n      isSized,\n      isItemDisabled,\n      isItemHovering,\n      isItemSelected,\n      scrollToItem,\n      resetScrollTop\n    };\n  },\n  render(_ctx, _cache) {\n    var _a;\n    const {\n      $slots,\n      data,\n      listProps,\n      select,\n      isSized,\n      width,\n      isItemDisabled,\n      isItemHovering,\n      isItemSelected\n    } = _ctx;\n    const Comp = isSized ? FixedSizeList : DynamicSizeList;\n    const {\n      props: selectProps,\n      onSelect,\n      onHover,\n      onKeyboardNavigate,\n      onKeyboardSelect\n    } = select;\n    const {\n      height,\n      modelValue,\n      multiple\n    } = selectProps;\n    if (data.length === 0) {\n      return h(\"div\", {\n        class: \"el-select-dropdown\",\n        style: {\n          width: `${width}px`\n        }\n      }, (_a = $slots.empty) == null ? void 0 : _a.call($slots));\n    }\n    const ListItem = withCtx(scoped => {\n      const {\n        index,\n        data: data2\n      } = scoped;\n      const item = data2[index];\n      if (data2[index].type === \"Group\") {\n        return h(script$1, {\n          item,\n          style: scoped.style,\n          height: isSized ? listProps.itemSize : listProps.estimatedSize\n        });\n      }\n      const selected = isItemSelected(modelValue, item);\n      const itemDisabled = isItemDisabled(modelValue, selected);\n      return h(script$2, {\n        ...scoped,\n        selected,\n        disabled: item.disabled || itemDisabled,\n        created: !!item.created,\n        hovering: isItemHovering(index),\n        item,\n        onSelect,\n        onHover\n      }, {\n        default: withCtx(props => {\n          return renderSlot($slots, \"default\", props, () => [h(\"span\", item.label)]);\n        })\n      });\n    });\n    const List = h(Comp, {\n      ref: \"listRef\",\n      className: \"el-select-dropdown__list\",\n      data,\n      height,\n      width,\n      total: data.length,\n      scrollbarAlwaysOn: selectProps.scrollbarAlwaysOn,\n      onKeydown: [_cache[1] || (_cache[1] = withKeys(withModifiers(() => onKeyboardNavigate(\"forward\"), [\"stop\", \"prevent\"]), [\"down\"])), _cache[2] || (_cache[2] = withKeys(withModifiers(() => onKeyboardNavigate(\"backward\"), [\"stop\", \"prevent\"]), [\"up\"])), _cache[3] || (_cache[3] = withKeys(withModifiers(onKeyboardSelect, [\"stop\", \"prevent\"]), [\"enter\"])), _cache[4] || (_cache[4] = withKeys(withModifiers(() => select.expanded = false, [\"stop\", \"prevent\"]), [\"esc\"])), _cache[5] || (_cache[5] = withKeys(() => select.expanded = false, [\"tab\"]))],\n      ...listProps\n    }, {\n      default: ListItem\n    });\n    return h(\"div\", {\n      class: {\n        \"is-multiple\": multiple,\n        \"el-select-dropdown\": true\n      }\n    }, [List]);\n  }\n});\nexport { script as default };","map":{"version":3,"names":["script","defineComponent","name","props","data","Array","hoveringIndex","Number","width","setup","select","inject","selectV2InjectionKey","cachedHeights","ref","listRef","isSized","computed","isUndefined","estimatedOptionHeight","listProps","value","itemSize","itemHeight","estimatedSize","idx","contains","arr","target","valueKey","isObject","includes","some","item","getValueByPath","isEqual","selected","isItemSelected","modelValue","multiple","isItemDisabled","disabled","multipleLimit","length","isItemHovering","scrollToItem","index","list","resetScrollTop","render","_ctx","_cache","$slots","Comp","FixedSizeList","DynamicSizeList","selectProps","onSelect","onHover","onKeyboardNavigate","onKeyboardSelect","height","h","class","style","_a","empty","call","ListItem","withCtx","scoped","data2","type","script$1","itemDisabled","script$2","created","hovering","default","renderSlot","label","List","className","total","scrollbarAlwaysOn","onKeydown","withKeys","withModifiers","expanded"],"sources":["../../../../../../packages/components/select-v2/src/select-dropdown.vue"],"sourcesContent":["<script lang=\"ts\">\nimport {\n  defineComponent,\n  computed,\n  inject,\n  ref,\n  renderSlot,\n  h,\n  withCtx,\n  withKeys,\n  withModifiers,\n} from 'vue'\nimport { getValueByPath, isUndefined, isObject } from '@element-plus/utils/util'\n// import { addResizeListener, removeResizeListener, ResizableElement } from '@element-plus/utils/resize-event'\nimport {\n  FixedSizeList,\n  DynamicSizeList,\n} from '@element-plus/components/virtual-list'\nimport GroupItem from './group-item.vue'\nimport OptionItem from './option-item.vue'\n\nimport { selectV2InjectionKey } from './token'\n\nimport type { ItemProps } from '@element-plus/components/virtual-list'\nimport type { OptionItemProps, Option } from './select.types'\n\nexport default defineComponent({\n  name: 'ElSelectDropdown',\n\n  props: {\n    data: Array,\n    hoveringIndex: Number,\n    width: Number,\n  },\n  setup(props) {\n    const select = inject(selectV2InjectionKey) as any\n    const cachedHeights = ref<Array<number>>([])\n\n    const listRef = ref(null)\n\n    const isSized = computed(() =>\n      isUndefined(select.props.estimatedOptionHeight)\n    )\n    const listProps = computed(() => {\n      if (isSized.value) {\n        return {\n          itemSize: select.props.itemHeight,\n        }\n      }\n\n      return {\n        estimatedSize: select.props.estimatedOptionHeight,\n        itemSize: (idx: number) => cachedHeights.value[idx],\n      }\n    })\n\n    const contains = (arr: Array<any> = [], target: any) => {\n      const {\n        props: { valueKey },\n      } = select\n\n      if (!isObject(target)) {\n        return arr.includes(target)\n      }\n\n      return (\n        arr &&\n        arr.some((item) => {\n          return (\n            getValueByPath(item, valueKey) === getValueByPath(target, valueKey)\n          )\n        })\n      )\n    }\n    const isEqual = (selected: unknown, target: unknown) => {\n      if (!isObject(target)) {\n        return selected === target\n      } else {\n        const { valueKey } = select.props\n        return (\n          getValueByPath(selected, valueKey) ===\n          getValueByPath(target, valueKey)\n        )\n      }\n    }\n\n    const isItemSelected = (modelValue: any[] | any, target: Option) => {\n      if (select.props.multiple) {\n        return contains(modelValue, target.value)\n      }\n      return isEqual(modelValue, target.value)\n    }\n\n    const isItemDisabled = (modelValue: any[] | any, selected: boolean) => {\n      const { disabled, multiple, multipleLimit } = select.props\n      return (\n        disabled ||\n        (!selected &&\n          (multiple\n            ? multipleLimit > 0 && modelValue.length >= multipleLimit\n            : false))\n      )\n    }\n\n    const isItemHovering = (target: number) => props.hoveringIndex === target\n\n    const scrollToItem = (index: number) => {\n      const list = listRef.value as any\n      if (list) {\n        list.scrollToItem(index)\n      }\n    }\n\n    const resetScrollTop = () => {\n      const list = listRef.value as any\n      if (list) {\n        list.resetScrollTop()\n      }\n    }\n\n    // computed\n    return {\n      select,\n      listProps,\n      listRef,\n      isSized,\n\n      isItemDisabled,\n      isItemHovering,\n      isItemSelected,\n\n      scrollToItem,\n      resetScrollTop,\n    }\n  },\n\n  render(_ctx, _cache) {\n    const {\n      $slots,\n\n      data,\n      listProps,\n      select,\n      isSized,\n      width,\n      // methods\n      isItemDisabled,\n      isItemHovering,\n      isItemSelected,\n    } = _ctx\n\n    const Comp = isSized ? FixedSizeList : DynamicSizeList\n\n    const {\n      props: selectProps,\n      onSelect,\n      onHover,\n      onKeyboardNavigate,\n      onKeyboardSelect,\n    } = select\n    const { height, modelValue, multiple } = selectProps\n\n    if (data.length === 0) {\n      return h(\n        'div',\n        {\n          class: 'el-select-dropdown',\n          style: {\n            width: `${width}px`,\n          },\n        },\n        $slots.empty?.()\n      )\n    }\n\n    const ListItem = withCtx((scoped: ItemProps<any>) => {\n      const { index, data } = scoped\n      const item = data[index]\n      // render group item which is not selectable.\n      if (data[index].type === 'Group') {\n        return h(GroupItem, {\n          item,\n          style: scoped.style,\n          height: isSized ? listProps.itemSize : listProps.estimatedSize,\n        })\n      }\n\n      const selected = isItemSelected(modelValue, item)\n      const itemDisabled = isItemDisabled(modelValue, selected)\n      // render option item which is selectable\n      return h(\n        OptionItem,\n        {\n          ...scoped,\n          selected,\n          disabled: item.disabled || itemDisabled,\n          created: !!item.created,\n          hovering: isItemHovering(index),\n          item,\n          onSelect,\n          onHover,\n        },\n        {\n          default: withCtx((props: OptionItemProps) => {\n            return renderSlot($slots, 'default', props, () => [\n              h('span', item.label),\n            ])\n          }),\n        }\n      )\n    })\n\n    const List = h(\n      Comp,\n      {\n        ref: 'listRef', // forwarded ref so that select can access the list directly\n        className: 'el-select-dropdown__list',\n        data,\n        height,\n        width,\n        total: data.length,\n        scrollbarAlwaysOn: selectProps.scrollbarAlwaysOn,\n        onKeydown: [\n          _cache[1] ||\n            (_cache[1] = withKeys(\n              withModifiers(\n                () => onKeyboardNavigate('forward'),\n                ['stop', 'prevent']\n              ),\n              ['down']\n            )),\n          _cache[2] ||\n            (_cache[2] = withKeys(\n              withModifiers(\n                () => onKeyboardNavigate('backward'),\n                ['stop', 'prevent']\n              ),\n              ['up']\n            )),\n          _cache[3] ||\n            (_cache[3] = withKeys(\n              withModifiers(onKeyboardSelect, ['stop', 'prevent']),\n              ['enter']\n            )),\n\n          _cache[4] ||\n            (_cache[4] = withKeys(\n              withModifiers(\n                () => (select.expanded = false),\n                ['stop', 'prevent']\n              ),\n              ['esc']\n            )),\n          _cache[5] ||\n            (_cache[5] = withKeys(() => (select.expanded = false), ['tab'])),\n          // _cache[6] || (_cache[6] = () => {\n          //   console.log(11)\n          // }),\n        ],\n        ...listProps,\n      },\n      {\n        default: ListItem,\n      }\n    )\n    return h(\n      'div',\n      {\n        class: {\n          'is-multiple': multiple,\n          'el-select-dropdown': true,\n        },\n      },\n      [List]\n    )\n  },\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}